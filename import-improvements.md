# План улучшений функционала импорта данных

## Общий план улучшений

1.  **Реализовать лоадеры:**
    *   Добавить глобальный лоадер, который будет отображаться при выполнении асинхронных операций.
    *   Интегрировать лоадер в компоненты, где выполняются асинхронные операции (например, при загрузке данных, отправке форм).
2.  **Изменение статуса зоны (DMP-менеджер):**
    *   Добавить новый API-маршрут (`/api/zones/[id]/status`) для изменения статуса зоны.
    *   Реализовать функцию в `lib/data/zones.ts` для обновления статуса зоны.
    *   Добавить UI-элемент (таблицу с зонами, фильтрами и поиском) на странице DMP-менеджера для изменения статуса.
    *   Вызывать API-маршрут при взаимодействии с UI-элементом.
3.  **Создание бронирований (категорийный менеджер):**
    *   Добавить UI для создания бронирований на странице категорийного менеджера (аналогично странице поставщика).
    *   Использовать существующую функцию `createBookingRequest` из `lib/services/bookingService.ts`.
    *   Учесть, что категорийный менеджер может создавать бронирования только для своей категории.
4.  **Экспорт/импорт базы данных:**
    *   **Экспорт:**
        *   Добавить новый API-маршрут (`/api/db/export`) для экспорта базы данных.
        *   Использовать библиотеку для генерации Excel-файлов (например, `exceljs`).
        *   Реализовать функцию в `lib/data/db.ts` (или подобном файле) для получения всех данных из базы данных.
        *   Сформировать Excel-файл и отправить его пользователю.
    *   **Импорт:**
        *   Добавить новый API-маршрут (`/api/db/import`).
        *   Использовать библиотеку для чтения Excel-файлов (например, `xlsx`).
        *   Реализовать функцию в `lib/data/db.ts` (или подобном файле) для обработки данных из Excel-файла.
        *   Обрабатывать дубликаты (обновление существующих).
        *   Добавить UI для загрузки файла.

## План улучшений импорта (MVP)

1.  **Улучшить обработку ошибок:**
    *   Добавить более подробную информацию об ошибках (номер строки, название столбца, тип ошибки).
    *   Возвращать структурированный ответ с информацией об ошибках.
2.  **Расширить валидацию данных:**
    *   Добавить проверки типов данных, формата данных.
    *   Использовать библиотеку `zod` для валидации данных.
3.  **Добавить транзакции:**
    *   Обернуть операции с базой данных в транзакцию.

## Детальный план по импорту (с использованием `zod`)

1.  **Установить `zod`:**

    ```bash
    npm install zod
    ```

2.  **Создать схему валидации:**

    *   Создать файл `lib/validation/zoneImportSchema.ts`.
    *   Определить схему валидации для данных зоны, импортируемых из Excel.

3.  **Улучшить обработку ошибок:**

    *   Изменить функцию `POST` в `app/api/upload-excel/route.ts`, чтобы она возвращала более подробную информацию об ошибках, включая ошибки валидации `zod`.
    *   Изменить функцию `createOrUpdateZone`, чтобы она возвращала информацию об ошибках, если они возникли.

4.  **Добавить транзакции:**

    *   Обернуть операции с базой данных в `app/api/upload-excel/route.ts` в транзакцию.

5.  **Интегрировать схему валидации:**

    *   Использовать схему `zoneImportSchema` в `app/api/upload-excel/route.ts` для валидации данных перед сохранением в базу данных.

## Исправление ошибок деплоя

1.  **Устранить ошибки ESLint и TypeScript:**
    *   Удалить неиспользуемые переменные, функции и импорты.
    *   Заменить `any` на более конкретные типы или добавить комментарии для подавления предупреждений ESLint.
    *   Добавить недостающие зависимости в массивы зависимостей хуков `useEffect`.
    *   Исправить объявление пустого интерфейса.

## Рефакторинг состояний и исправление ошибок ESLint в store и providers

1. **Исправление ошибок в `app/providers.tsx`:**
   * Удалить дублирование директивы "use client".

2. **Исправление ошибок в `lib/store.ts`:**
   * Удалить закомментированный импорт и закомментированные блоки кода.
   * Исправить типизацию в функциях `handleApprove` и `handleReject`.
   * Исправить ошибку "get is defined but never used".

3. **Перенос состояний из компонентов в store:**
   * Проанализировать использование `useState` в компонентах.
   * Определить, какие состояния следует перенести в глобальный store, а какие в компонентные store.
   * Создать функции в store для управления этими состояниями.
   * Рефакторинг компонентов для использования store вместо `useState`.

4. **Критерии переноса состояний в store:**
   * Состояние используется несколькими компонентами.
   * Состояние должно сохраняться между перезагрузками страниц или переходами по маршрутам.
   * Состояние имеет сложную логику обновления.
   * Состояние требует синхронизации между разными частями приложения.